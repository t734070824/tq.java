2019-07-30

## 多次重复下载大文件(CPU高 频繁GC)

### Top
1. 查看那个进程占用CPU过高

### 进程下的线程列表
1. ps -mp pid -o THREAD,tid,time

### 16 进制
1. printf "%x\n" tid

### 线程堆栈信息
1. jstack 26481 >> jstat.out
2. 寻找 RUNNING 状态的线程

### 发现
1. 用户一次性下载一个大文件
2. 由于响应时间较长, 多次点击, 造成多次下载
3. 内存不足 频繁 GC CPU 高

### 解决
1. 重启, 可以使用

### 优化
1. 前端限制次数
2. 后端 请求缓存, 多个相同请求只处理一次
3. 下载 优化, 使用单独的下载微服务