2019-01-14

## 初识

### Kafka
1. 主题与分区
    - 通过主题进行分类
    - 追加的方式写入分区
    - 主题可以分为若干个分区, 一个分区就是一个提交日志
    - 消息已追加的方式写入分区, 然后已 先入先出 的顺序读取
    - 无法再整个主题范围内保证消息的顺序
    - 一个主题可以横跨多个服务器
2. 生产者与消费者
    - 消费者
        - 消费者通过检查消息的偏移量来区分已经读过的消息
        - 偏移量
            - 是一种元数据
            - 一个不断递增的整数值
            - 消费者把每个分区最后读取的消息偏移量保存在 Zookeeper 或 Kafka 上，如果悄费者关闭或重启，它的读取状态不会丢失。
        - 消费者是消费者群组的一部分
            - 会有一个或多个消费者共同读取一个主题
            - **群组保证每个分区只能被一个消费者使用**
3. broker和集群
    - broker
        - 一个独立的Kafka服务器是一个 broker
        - broker **接受** 来自生产者的消息, **设置** 偏移量, **提交**消息到磁盘保存
        - **为消费者返回已经提交到磁盘上的消息**
    - 集群
        - broker 是集群的一部分
        - 每个集群都有一个broker 同时充当集群控制器的角色(自动从集群中活跃的成员中选取出来)
            - 控制器负责管理工作
            - 将分区分配给broker, 监控broker
            - **一个分区从属与一个broker, 该broker 是这个分区的首领**
            - 一个分区会分配给多个 broker, 此时产生 **分区复制**
        - 保留消息
            - 要么保留一段时间（比如 7 天），要么保留到消息达到一定大小的字节数（比如 lGB ）。
            - 当消息数量达到这些上限时，旧消息就会过期井被删除，
            - 所以在任何时刻， 可用消息的总量都不会超过配置参数所指定的大小
4. 多集群
    - 数据类型分离
    - 安全需求隔离
    - 多数据中心(灾难恢复)
    - MirrorMaker
        - 集群间消息同步
5. 使用场景
    - 活动跟踪
    - 传递消息
    - 日志记录
    - 提交日志
        - 数据库更新
    - 流处理