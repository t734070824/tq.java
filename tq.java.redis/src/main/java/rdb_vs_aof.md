2019-07-31

## RDB VS AOF

### RDB
1. bgsave
2. 备份 全量复制
3. 快 无法实时同步 不如 AOF
4. fork 子进程 内存较大的时候 时间较长 重量级操作
4. 做了文件压缩, 远小于内存大小

### AOF
1. 独立日志的方式记录每一次写命令
2. 解决数据持久化的实时性, 主流方式
3. 重写机制
    - 当AOF 文件越来愈大的时候, 重写机制压缩文件体积
    - 超时的数据不在写入
    - 无效命令
    - 合并
4. 每秒 fsync, 数据恢复较慢, 不适合冷备


### 选择
1. 不要仅仅使用RDB这样会丢失很多数据。
2. 也不要仅仅使用AOF，因为这一会有两个问题，
    第一通过AOF做冷备没有RDB做冷备恢复的速度快；第二RDB每次简单粗暴生成数据快照，更加健壮。
3. 综合AOF和RDB两种持久化方式，用AOF来保证数据不丢失，作为恢复数据的第一选择；
    用RDB来做不同程度的冷备，在AOF文件都丢失或损坏不可用的时候，可以使用RDB进行快速的数据恢复