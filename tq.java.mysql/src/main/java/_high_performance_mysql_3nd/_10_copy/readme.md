2018-11-18

## 复制
1. 复制如何工作
2. 基本的复制服务搭建
3. 相关的配置以及如何管理和优化复制服务器
4. 复制在什么情况下会失败

## 概述
1. 2中复制方式
    - **基于行的复制**
        - Mysql 5.1
    - **基于语句的复制**
        - Mysql 3.23
2. 都是相同的方式
    - 主库记录二进制日志
    - 备库重放日志

### 解决的问题
1. 数据分布
    - 不同的地理位置来分布数据备份
    - 为了保持低延迟的复制, 最好有一个稳定,低延迟连接
2. 负载均衡
    - 读操作分布在多个服务器上, 对读密集型应用的优化
3. 备份
    - 复制是有意义的技术补充, 但是 复制不是备份, 也不可以取代备份
4. 高可用和故障切换
    - 避免 mysql 单点失败
    
### 如何工作
1. 步骤
    - 在 主库上 把数据修改记录到二进制日志中(Binary Log) 
        - 每次提交事务完成数据更新前
        - 事务提交的顺序而不是每条语句的执行顺序
    - 备库将主库上的日志复制到自己的 中继(Relay Log)日志中
        - 备库启动工作线程, I/O线程, 普通的客户端连接
        - 在主库上启动一个特殊的二进制转储线程(Binlog dump)
            - 读取主库上的二进制日志文件中的事件
            - 不轮询, 和主库统一则睡眠
            -  新的事件时被唤醒, I/O线程同步到中继日志
    - 备库读取中继日志中的事件, 将其重放到备库数据之上
        - sql线程重放中继日志
2. 作用
    - 实现获取事件和重放事件的解耦
3. 问题
    - **单个sql线程带来性能瓶颈**