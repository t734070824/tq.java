2019-08-11

## Lock

### 主流锁
1. 线程要不要锁住资源
    - 锁住 -- 悲观锁
    - 不锁柱 -- 乐观锁
        - cas + 自旋
        - 原子类的递增操作
    - 区别: **是否在使用数据的时候直接加锁**
2. 锁住同步资源失败, 线程要不要阻塞
    - 阻塞
    - 不阻塞
        - 自旋锁
        - 适应性自旋锁
3. 多个线程竞争同步资源的流程细节
    - 不锁柱资源, 多个线程只有一个修改资源成功, 其他重试  -- 无锁
    - 同一个线程执行同步资源时自动获取资源 -- 偏向锁
    - 多个线程同步竞争, 失败的自旋等待锁释放 -- 自旋锁
        - 系统切换CPU, 不放弃CPU时间片, 空转
        - 防止一直自旋, 设置自旋次数
        - **JVM 实现**
    - 多个线程同步竞争, 失败的阻塞 等待唤醒 -- 重量级锁
    
4. 多个线程竞争锁要不要排队
    - 直接排队 -- 公平锁
    - 尝试插队, 失败之后在排队 -- 非公平锁
    - **区别: 是否先去查看队列中是否有在等待的线程, 还是直接竞争锁**
5. 一个线程在多个流程中能不能获取同一把锁
    - 可以 -- 可重入锁
    - 不可以 -- 不可重入锁
6. 多个线程能不能公用一把锁
    - 能 -- 共享锁
    - 不能 -- 排他锁
    
### Synchronized 如何实现线程同步
1. java 对象头
    - 悲观锁
    - 加锁
2. Monitor
    - 通过 Monitor 实现线程同步, Monitor 依赖与底层操作系统的 Mutex Lock(互斥锁) 来实现的线程同步
    
         